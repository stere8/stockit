@page "/ProductEdit"
@using System.Globalization
@using StockIT.Models
@model StockIT.Pages.ProductEditModel

@{
    var product = Model?.ProductModel;
}

<head>
    <script src="~/ckeditor/ckeditor.js"></script>
</head>

<h2>Edit Product</h2>

<form method="post" enctype="multipart/form-data" class="mt-3">

    <!-- Name -->
    <div class="form-group mb-3">
        <label for="Name">Name:</label>
        <input type="text"
               id="Name"
               name="Name"
               value="@(product?.Name ?? string.Empty)"
               class="form-control"
               required />
    </div>

    <!-- Hidden Id -->
    <input type="hidden" id="id" name="Id" value="@(product?.Id ?? 0)" />

    <!-- Description -->
    <div class="form-group mb-3">
        <label for="description">Description:</label>
        <textarea id="description"
                  name="Description"
                  class="form-control"
                  required>@(product?.Description ?? string.Empty)</textarea>
    </div>

    <!-- Quantity -->
    <div class="form-group mb-3">
        <label for="Quantity">Quantity:</label>
        <input type="number"
               id="Quantity"
               name="Quantity"
               value="@(product?.Quantity ?? 0)"
               class="form-control"
               required />
    </div>

    <!-- Price -->
    <div class="form-group mb-3">
        <label for="Price">Price:</label>
        <input type="number"
               id="Price"
               name="Price"
               value="@(product?.Price.ToString(CultureInfo.InvariantCulture) ?? "0.00")"
               class="form-control"
               step="0.01"
               required />
    </div>

    <!-- Category -->
    <div class="form-group mb-3">
        <label for="CategoryId">Category:</label>
        <select id="CategoryId" name="CategoryId" class="form-control" required>
            @if (Model?.Categories != null && Model.Categories.Any())
            {
                foreach (var category in Model.Categories)
                {
                    <option value="@category.Id" selected="@(product?.CategoryId == category.Id)">
                        @category.Name
                    </option>
                }
            }
            else
            {
                <option disabled>No categories available</option>
            }
        </select>
    </div>

    <!-- Image Upload -->
    <div class="form-group mb-4">
        @if (product?.Image != null)
        {
            <img src="/uploads/@product.Image.FileName" alt="Current pic" style="max-width: 200px; display:block; margin-bottom:10px;" />
        }
        <label for="image">Product Image (Optional):</label>
        <input type="file"
               id="image"
               name="Image"
               accept="image/*"
               class="form-control" />
        <small class="form-text text-muted">Leave blank to keep existing images.</small>
    </div>

    <button type="submit" class="btn btn-primary">Save Changes</button>
</form>

<script>
    ClassicEditor
        .create(document.querySelector("#description"))
        .catch(error => console.error(error));
</script>
